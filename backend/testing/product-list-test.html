<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product List Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        h1 { color: #2c3e50; }
        .product-list { display: flex; flex-wrap: wrap; gap: 2em; }
        .product-card { border: 1px solid #ccc; border-radius: 8px; padding: 1em; width: 250px; box-shadow: 2px 2px 8px #eee; }
        .product-card img { width: 100%; height: 180px; object-fit: contain; border-radius: 4px; background: #f8f8f8; }
        .product-title { font-weight: bold; margin: 0.5em 0; }
        .product-meta { font-size: 0.95em; color: #555; }
    </style>
</head>
<body>
    <h1>Product List (DB Test)</h1>
    <div id="product-list" class="product-list"></div>
    <script>
        // Change this to your local or tunnel API endpoint
        const API_URL = 'http://localhost:3000/api/products';
        // const API_URL = 'https://sri2025backend.loca.lt/api/products'; // For tunnel

        async function fetchProducts() {
            const res = await fetch(API_URL);
            const products = await res.json();
            return products;
        }

        function getImageUrl(product) {
            // Always use the imageUrl field if present (should be full S3 link)
            if (product.imageUrl) return product.imageUrl;
            if (product.image) return product.image;
            return 'https://via.placeholder.com/250x180?text=No+Image';
        }

        function renderProducts(products) {
            const list = document.getElementById('product-list');
            list.innerHTML = '';
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <img src="${getImageUrl(product)}" alt="${product.name}">
                    <div class="product-title">${product.name}</div>
                    <div class="product-meta">Carbon: ${product.carbon ?? '-'} | Plastic: ${product.plastic ?? '-'} | Points: ${product.points ?? '-'}</div>
                `;
                list.appendChild(card);
            });
        }

        fetchProducts().then(renderProducts).catch(err => {
            document.getElementById('product-list').innerHTML = '<p style="color:red">Failed to load products.</p>';
            console.error(err);
        });
    </script>
</body>
</html>
